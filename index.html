<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>看板專案管理系統 (Kanban Project Management)</title>
    
    <!-- 引入 Tailwind CSS 以快速建構現代化 UI -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 引入 Google Fonts 的 Inter 字體 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- 引入 SortableJS 函式庫，這是實現拖曳功能的核心 -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>

    <style>
        /* 基本樣式設定 */
        body {
            font-family: 'Inter', sans-serif;
            -ms-overflow-style: none; /* IE and Edge */
            scrollbar-width: none; /* Firefox */
        }
        body::-webkit-scrollbar {
            display: none; /* Chrome, Safari, and Opera */
        }
        
        /* 拖曳時的 ghost 樣式 (半透明的預覽項目) */
        .ghost-card {
            opacity: 0.5;
            background: #c8ebfb;
            border: 1px dashed #333;
        }
        .ghost-list {
            opacity: 0.5;
            background: #d1d5db;
        }

        /* 讓看板容器可以水平滾動 */
        #board-container {
            -ms-overflow-style: none; /* IE and Edge */
            scrollbar-width: none; /* Firefox */
        }
        #board-container::-webkit-scrollbar {
            display: none; /* Chrome, Safari, and Opera */
        }
    </style>
</head>
<body class="bg-blue-600 h-screen overflow-hidden flex flex-col">

    <!-- 頂部導覽列 -->
    <header class="bg-blue-700/50 text-white p-4 flex justify-between items-center flex-shrink-0">
        <h1 class="text-xl font-bold">看板專案管理系統</h1>
        <!-- 未來可以放使用者頭像、篩選等功能 -->
        <div>
            <button class="bg-white/20 hover:bg-white/30 px-4 py-2 rounded-md font-semibold">登入</button>
        </div>
    </header>

    <!-- 主看板區域 -->
    <main id="board-container" class="flex-grow overflow-x-auto overflow-y-hidden p-4 flex items-start gap-4">
        <!-- 列表 (List) 將會動態插入到這裡 -->
        
        <!-- 新增列表的按鈕 -->
        <div class="flex-shrink-0">
            <button id="add-list-btn" class="bg-white/20 hover:bg-white/30 text-white w-72 h-10 px-4 py-2 rounded-lg font-semibold flex items-center justify-start">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
                </svg>
                新增其他列表
            </button>
        </div>
    </main>

    <!-- Modal 彈出視窗 (用於新增/編輯) -->
    <div id="modal" class="fixed inset-0 bg-black/60 items-center justify-center hidden">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-md">
            <h3 id="modal-title" class="text-xl font-bold mb-4">Modal Title</h3>
            <input id="modal-input" type="text" class="w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring-blue-500" placeholder="請輸入標題...">
            <div class="mt-6 flex justify-end gap-3">
                <button id="modal-cancel-btn" class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-md font-semibold">取消</button>
                <button id="modal-save-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md font-semibold">儲存</button>
            </div>
        </div>
    </div>


    <script>
        // --- 應用程式狀態管理 (State Management) ---
        // 在真實應用中，這些資料會來自後端 API
        let boardState = {
            lists: [
                {
                    id: 'list-1',
                    title: '待辦事項 (To-Do)',
                    cards: [
                        { id: 'card-1', title: '設計使用者登入頁面' },
                        { id: 'card-2', title: '規劃資料庫 Schema' },
                        { id: 'card-3', title: '研究權限控管 (RBAC) 實作方式' },
                    ]
                },
                {
                    id: 'list-2',
                    title: '進行中 (In Progress)',
                    cards: [
                        { id: 'card-4', title: '開發前端拖曳功能原型' }
                    ]
                },
                {
                    id: 'list-3',
                    title: '已完成 (Done)',
                    cards: [
                        { id: 'card-5', title: '完成專案架構設計文件' }
                    ]
                }
            ]
        };

        // --- DOM 元素選擇器 ---
        const boardContainer = document.getElementById('board-container');
        const addListBtn = document.getElementById('add-list-btn');
        const modal = document.getElementById('modal');
        const modalTitle = document.getElementById('modal-title');
        const modalInput = document.getElementById('modal-input');
        const modalCancelBtn = document.getElementById('modal-cancel-btn');
        const modalSaveBtn = document.getElementById('modal-save-btn');

        let currentModalAction = null; // 用來儲存當前 modal 的操作 (e.g., addList, addCard)

        // --- 核心渲染函式 ---
        function renderBoard() {
            // 清空現有看板內容 (除了新增列表按鈕)
            const listsToRemove = boardContainer.querySelectorAll('.list-wrapper');
            listsToRemove.forEach(list => list.remove());

            boardState.lists.forEach((list, listIndex) => {
                // 創建列表的容器
                const listWrapper = document.createElement('div');
                listWrapper.className = 'list-wrapper flex-shrink-0 w-72';
                listWrapper.setAttribute('data-list-id', list.id);

                const listElement = document.createElement('div');
                listElement.className = 'list bg-gray-200 rounded-lg p-2 shadow-md';
                
                // 列表標題
                const listHeader = document.createElement('h2');
                listHeader.className = 'font-bold p-2 text-gray-800';
                listHeader.textContent = list.title;
                listElement.appendChild(listHeader);

                // 卡片容器
                const cardsContainer = document.createElement('div');
                cardsContainer.className = 'cards-container space-y-2 p-1 min-h-[40px]';
                cardsContainer.setAttribute('data-list-id', list.id);

                // 渲染卡片
                list.cards.forEach((card, cardIndex) => {
                    const cardElement = document.createElement('div');
                    cardElement.className = 'card bg-white rounded-md p-3 shadow cursor-pointer hover:bg-gray-50';
                    cardElement.textContent = card.title;
                    cardElement.setAttribute('data-card-id', card.id);
                    cardsContainer.appendChild(cardElement);
                });

                listElement.appendChild(cardsContainer);

                // 新增卡片按鈕
                const addCardBtn = document.createElement('button');
                addCardBtn.className = 'add-card-btn text-gray-500 hover:bg-gray-300 w-full text-left p-2 rounded-md mt-2';
                addCardBtn.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-1" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z" clip-rule="evenodd" />
                    </svg>
                    新增卡片
                `;
                addCardBtn.addEventListener('click', () => {
                    openModal('addCard', { listId: list.id });
                });
                listElement.appendChild(addCardBtn);

                listWrapper.appendChild(listElement);
                // 將新的列表插入到 "新增列表" 按鈕之前
                boardContainer.insertBefore(listWrapper, addListBtn.parentElement);
            });

            // 初始化拖曳功能
            initializeSortable();
        }

        // --- 拖曳功能初始化 (核心) ---
        function initializeSortable() {
            // 讓列表可以左右拖曳排序
            new Sortable(boardContainer, {
                animation: 150,
                handle: '.list', // 只能透過列表本身拖曳，而不是整個 wrapper
                ghostClass: 'ghost-list',
                onEnd: (evt) => {
                    const movedList = boardState.lists.splice(evt.oldIndex, 1)[0];
                    boardState.lists.splice(evt.newIndex, 0, movedList);
                    // 在真實應用中，這裡會發送 API 更新後端數據
                    console.log('列表順序已更新:', boardState.lists);
                }
            });

            // 讓卡片可以在列表內及列表間拖曳
            const cardContainers = document.querySelectorAll('.cards-container');
            cardContainers.forEach(container => {
                new Sortable(container, {
                    group: 'cards', // 關鍵設定：讓不同列表的卡片可以互通
                    animation: 150,
                    ghostClass: 'ghost-card',
                    onEnd: (evt) => {
                        const cardId = evt.item.dataset.cardId;
                        const fromListId = evt.from.dataset.listId;
                        const toListId = evt.to.dataset.listId;
                        
                        const fromList = boardState.lists.find(l => l.id === fromListId);
                        const toList = boardState.lists.find(l => l.id === toListId);

                        // 找到被移動的卡片
                        const movedCard = fromList.cards.splice(evt.oldIndex, 1)[0];
                        // 將卡片插入到新的列表
                        toList.cards.splice(evt.newIndex, 0, movedCard);

                        // 在真實應用中，這裡會發送 API 更新後端數據
                        console.log(`卡片 ${cardId} 從 ${fromListId} 移動到 ${toListId}`);
                        console.log('看板狀態已更新:', boardState);
                    }
                });
            });
        }

        // --- Modal 相關函式 ---
        function openModal(action, context = {}) {
            currentModalAction = { action, context };
            modalInput.value = '';
            if (action === 'addList') {
                modalTitle.textContent = '新增列表';
                modalInput.placeholder = '請輸入列表標題...';
            } else if (action === 'addCard') {
                modalTitle.textContent = '新增卡片';
                modalInput.placeholder = '請輸入卡片標題...';
            }
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            modalInput.focus();
        }

        function closeModal() {
            modal.classList.add('hidden');
            modal.classList.remove('flex');
            currentModalAction = null;
        }

        // --- 事件處理 (Event Handlers) ---
        addListBtn.addEventListener('click', () => {
            openModal('addList');
        });

        modalCancelBtn.addEventListener('click', closeModal);
        modal.addEventListener('click', (e) => {
            if (e.target === modal) {
                closeModal();
            }
        });
        
        modalInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') {
                modalSaveBtn.click();
            }
        });

        modalSaveBtn.addEventListener('click', () => {
            const title = modalInput.value.trim();
            if (!title) return;

            const { action, context } = currentModalAction;

            if (action === 'addList') {
                const newList = {
                    id: `list-${Date.now()}`,
                    title: title,
                    cards: []
                };
                boardState.lists.push(newList);
            } else if (action === 'addCard') {
                const list = boardState.lists.find(l => l.id === context.listId);
                if (list) {
                    const newCard = {
                        id: `card-${Date.now()}`,
                        title: title
                    };
                    list.cards.push(newCard);
                }
            }

            closeModal();
            renderBoard();
        });

        // --- 應用程式初始化 ---
        document.addEventListener('DOMContentLoaded', () => {
            renderBoard();
        });

    </script>
</body>
</html>
